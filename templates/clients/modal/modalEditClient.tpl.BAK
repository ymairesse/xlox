<!-- Modal -->
<div
  class="modal fade"
  id="modalEditClient"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  tabindex="-1"
  aria-labelledby="modalEditClientLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title w-100" id="modalEditClientLabel">
          Fiche Client
          <div class="btn-group float-end pe-4" 
            title="Sélection du type de client"
            data-toggle="tooltip"
            >

            <input 
              type="radio" 
              class="btn-check setTypeClient setTypeEntreprise" 
              name="entrepriseOuPrive" 
              id="entreprise" 
              autocomplete="off" 
              {if $dataClient.typeClient == "entreprise"}checked{/if}
              >
            <label 
              class="btn btn-outline-primary" 
              for="entreprise">
              <i class="fa fa-user-o" aria-hidden="true"></i> Entreprise
            </label>

            <input 
              type="radio" 
              class="btn-check setTypeClient setTypePrive" 
              name="entrepriseOuPrive" 
              id="prive" 
              autocomplete="off" 
              {if $dataClient.typeClient == "prive"}checked{/if} 
              >
            <label 
              class="btn btn-outline-primary" 
              for="prive">
              <i class="fa fa-industry" aria-hidden="true"></i> Privé
            </label>

          </div>
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>

      <div class="modal-body">
        {if $typeClient == 'entreprise'} 
            <!-- C'est une entreprise -->
            {include file="clients/modal/modalEntreprise.inc.tpl"} 
          {else} 
            <!-- C'est (probablement) un client privé -->
            {include file="clients/modal/modalPrive.inc.tpl"} 
        {/if}
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Annuler
        </button>

          <button
            type="button"
            class="btn btn-primary"
            id="btn-saveClient"
            {if ($dataClient.rgpd != 1)}
            disabled
            {/if}
          >
            Enregistrer
          </button>

      </div>
    </div>
  </div>
</div>

<style>
  div.error {
    color: red;
  }

  .visu {
    background-color: #ffef007a;
  }
</style>

<script>

  function phoneFormatter() {
    $(".phone").on("input", function () {
      var number = $(this)
        .val()
        .replace(/[^\d+]/g, "");
      if (number.length == 9) {
        var pfx = number.substr(0, 2);
        var no = number.substr(2);
        number = pfx + " " + no;
      } else if (number.length == 10) {
        var pfx = number.substr(0, 4);
        var no = number.substr(4);
        number = pfx + " " + no;
      }
      $(this).val(number);
    });
  }

  $(document).ready(function () {


    $(phoneFormatter);

    var tooltipTriggerList = [].slice.call(
      document.querySelectorAll('[data-bs-toggle="tooltip"]')
    );
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });


    $("#modalFormClientPrive").validate({
      lang: "fr",
      errorElement: "div",
      rules: {
        nom: {
          required: true,
        },
        prenom: {
          required: true,
        },
        telephone: {
          require_from_group: [1, ".contact"],
        },
        gsm: {
          require_from_group: [1, ".contact"],
        },
        mail: {
          require_from_group: [1, ".contact"],
        },
      },
    });

    $('#modalFormClientEntreprise').validate({
      lang: "fr",
      errorElement: "div",
      rules: {
        entreprise: {
          required: true,
        },
        telephone: {
          require_from_group: [1, ".contact"],
        },
        gsm: {
          require_from_group: [1, ".contact"],
        },
        mail: {
          required: true,
        },
        tva: {
          required: true,
          number: true,
        },
      },
    })
  });
</script>
